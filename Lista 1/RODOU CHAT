#include <stdio.h>

int main() {
    int n, i, j;
    float nota1, nota2, nota3, nota4;
    float media_final, media_geral = 0, maior_media, menor_media;
    int aluno_maior_media, aluno_menor_media;
    int matricula_atual = 1;

    do {
        printf("Entre com o numero de alunos da turma: ");
        scanf("%d", &n);
        if (n <= 0 || n > 50) {
            printf("O numero de alunos na turma deve ser maior do que zero e menor ou igual a 50\n");
        }
    } while (n <= 0 || n > 50);

    for (i = 1; i <= n; i++) {
        do {
            printf("Notas aluno %d: ", i);
            scanf("%f %f %f %f", &nota1, &nota2, &nota3, &nota4);
            if (nota1 < 0 || nota1 > 10 || nota2 < 0 || nota2 > 10 || nota3 < 0 || nota3 > 10 || nota4 < 0 || nota4 > 10) {
                printf("Todas as notas do aluno devem ser maiores ou iguais a zero e menores ou iguais a 10\n");
            }
        } while (nota1 < 0 || nota1 > 10 || nota2 < 0 || nota2 > 10 || nota3 < 0 || nota3 > 10 || nota4 < 0 || nota4 > 10);

        if (nota1 == nota2 && nota2 == nota3 && nota3 == nota4) {
            // Todas as notas são iguais
            media_final = (nota1 + nota2 + nota3 + nota4) * 2.5 / 10.0;
        } else if ((nota1 > nota2 && nota2 == nota3 && nota3 == nota4) || 
                   (nota2 > nota1 && nota1 == nota3 && nota3 == nota4) || 
                   (nota3 > nota1 && nota1 == nota2 && nota2 == nota4) || 
                   (nota4 > nota1 && nota1 == nota2 && nota2 == nota3)) {
            // Uma nota é maior e as outras iguais
            media_final = (nota1 * 4 + nota2 * 2 + nota3 * 2 + nota4 * 2) / 10.0;
        } else if ((nota1 < nota2 && nota2 == nota3 && nota3 == nota4) || 
                   (nota2 < nota1 && nota1 == nota3 && nota3 == nota4) || 
                   (nota3 < nota1 && nota1 == nota2 && nota2 == nota4) || 
                   (nota4 < nota1 && nota1 == nota2 && nota2 == nota3)) {
            // Uma nota é menor e as outras iguais
            media_final = (nota1 * 1 + nota2 * 3 + nota3 * 3 + nota4 * 3) / 10.0;
        } else {
            // Todas as notas são diferentes
            float maior, segunda, terceira, menor;

            // Ordena as notas para a ponderação correta
            if (nota1 >= nota2 && nota1 >= nota3 && nota1 >= nota4) {
                maior = nota1;
                if (nota2 >= nota3 && nota2 >= nota4) {
                    segunda = nota2;
                    terceira = nota3 >= nota4 ? nota3 : nota4;
                    menor = nota3 < nota4 ? nota3 : nota4;
                } else if (nota3 >= nota2 && nota3 >= nota4) {
                    segunda = nota3;
                    terceira = nota2 >= nota4 ? nota2 : nota4;
                    menor = nota2 < nota4 ? nota2 : nota4;
                } else {
                    segunda = nota4;
                    terceira = nota2 >= nota3 ? nota2 : nota3;
                    menor = nota2 < nota3 ? nota2 : nota3;
                }
            } else if (nota2 >= nota1 && nota2 >= nota3 && nota2 >= nota4) {
                maior = nota2;
                if (nota1 >= nota3 && nota1 >= nota4) {
                    segunda = nota1;
                    terceira = nota3 >= nota4 ? nota3 : nota4;
                    menor = nota3 < nota4 ? nota3 : nota4;
                } else if (nota3 >= nota1 && nota3 >= nota4) {
                    segunda = nota3;
                    terceira = nota1 >= nota4 ? nota1 : nota4;
                    menor = nota1 < nota4 ? nota1 : nota4;
                } else {
                    segunda = nota4;
                    terceira = nota1 >= nota3 ? nota1 : nota3;
                    menor = nota1 < nota3 ? nota1 : nota3;
                }
            } else if (nota3 >= nota1 && nota3 >= nota2 && nota3 >= nota4) {
                maior = nota3;
                if (nota1 >= nota2 && nota1 >= nota4) {
                    segunda = nota1;
                    terceira = nota2 >= nota4 ? nota2 : nota4;
                    menor = nota2 < nota4 ? nota2 : nota4;
                } else if (nota2 >= nota1 && nota2 >= nota4) {
                    segunda = nota2;
                    terceira = nota1 >= nota4 ? nota1 : nota4;
                    menor = nota1 < nota4 ? nota1 : nota4;
                } else {
                    segunda = nota4;
                    terceira = nota1 >= nota2 ? nota1 : nota2;
                    menor = nota1 < nota2 ? nota1 : nota2;
                }
            } else {
                maior = nota4;
                if (nota1 >= nota2 && nota1 >= nota3) {
                    segunda = nota1;
                    terceira = nota2 >= nota3 ? nota2 : nota3;
                    menor = nota2 < nota3 ? nota2 : nota3;
                } else if (nota2 >= nota1 && nota2 >= nota3) {
                    segunda = nota2;
                    terceira = nota1 >= nota3 ? nota1 : nota3;
                    menor = nota1 < nota3 ? nota1 : nota3;
                } else {
                    segunda = nota3;
                    terceira = nota1 >= nota2 ? nota1 : nota2;
                    menor = nota1 < nota2 ? nota1 : nota2;
                }
            }

            media_final = (maior * 4 + segunda * 3 + terceira * 2 + menor * 1) / 10.0;
        }

        media_geral += media_final;

        printf("Media final do aluno %d: %.1f\n", i, media_final);

        if (i == 1) {
            maior_media = media_final;
            menor_media = media_final;
            aluno_maior_media = matricula_atual;
            aluno_menor_media = matricula_atual;
        } else {
            if (media_final > maior_media) {
                maior_media = media_final;
                aluno_maior_media = matricula_atual;
            }
            if (media_final < menor_media) {
                menor_media = media_final;
                aluno_menor_media = matricula_atual;
            }
        }

        matricula_atual++;
    }

    media_geral /= n;
    printf("Media geral da turma: %.1f\n", media_geral);
    printf("Maior media da turma: %.1f (Aluno: %d)\n", maior_media, aluno_maior_media);
    printf("Menor media da turma: %.1f (Aluno: %d)\n", menor_media, aluno_menor_media);

    return 0;
}
