#include <stdio.h>

#define MAX_VENDEDORES 9
#define MAX_DIAS 31
#define MAX_VENDAS 1000  // Limite máximo de vendas para armazenar notas fiscais

int main() {
    // Variáveis
    int mes, num_vendedores, nota_fiscal, dia, codigo_vendedor, total_vendas = 0;
    int vendas_por_dia[MAX_DIAS] = {0}, vendas_por_vendedor[MAX_VENDEDORES + 1] = {0};
    int notas_fiscais[MAX_VENDAS] = {0};  // Armazenar notas fiscais para verificar duplicação
    int total_notas_fiscais = 0;          // Contador de notas fiscais inseridas
    float valor_venda, total_vendas_mes = 0.0, total_comissao_mes = 0.0;
    float total_vendedor[MAX_VENDEDORES + 1] = {0.0}, comissao_vendedor[MAX_VENDEDORES + 1] = {0.0};
    float total_vendas_por_dia[MAX_DIAS] = {0.0}, vendas_dia_vendedor[MAX_VENDEDORES + 1][MAX_DIAS] = {{0.0}};

    // Pedir o mês
    do {
        printf("Entre com o mes em que as vendas foram realizadas: ");
        scanf("%d", &mes);
        printf("\n");
        if (mes < 1 || mes > 12) {
            printf("Mes deve ser maior ou igual a 1 e menor ou igual a 12\n\n");
        }
    } while (mes < 1 || mes > 12);

    // Pedir o número de vendedores
    do {
        printf("Entre com o numero de vendedores que trabalharam no mes: ");
        scanf("%d", &num_vendedores);
        printf("\n");
        if (num_vendedores < 1 || num_vendedores > MAX_VENDEDORES) {
            printf("Numero de vendedores deve ser maior do que zero\n");
        }
    } while (num_vendedores < 1 || num_vendedores > MAX_VENDEDORES);

    // Instrução sobre o encerramento
    printf("Entre com as vendas. Para cada venda realizada no mes informar o numero da nota fiscal que a identifica, o codigo do vendedor responsavel, o dia do mes em que foi feita e o valor da venda em reais. Quando desejar finalizar a entrada de dados digite o numero zero para a nota fiscal.\n");
    printf("\n");

    // Entrada das vendas
    while (1) {
        int erro = 0;  // Flag para verificar se há algum erro

        printf("Venda: ");
        scanf("%d", &nota_fiscal,"\n");
        printf("\n");
        
        // Encerrar se a nota fiscal for 0
        if (nota_fiscal == 0) {
            break;  // Sai do loop para exibir os relatórios
        }

        // Continuar leitura dos outros dados
        scanf("%d %d %f", &codigo_vendedor, &dia, &valor_venda);

        // Validação do código do vendedor
        if (codigo_vendedor < 1 || codigo_vendedor > num_vendedores) {
            printf("Codigo do vendedor invalido\n");
            erro = 1;
        }

        // Validação do dia da venda
        if (dia < 1 || (mes == 2 && dia > 28) || ((mes == 4 || mes == 6 || mes == 9 || mes == 11) && dia > 30) || dia > 31) {
            printf("Dia da venda invalido\n");
            erro = 1;
        }

        // Validação do valor da venda
        if (valor_venda <= 0) {
            printf("Valor da venda invalida\n");
            erro = 1;
        }

        // Verificar se a nota fiscal é repetida, mas só validar se não houver erro nos outros campos
        if (!erro) {
            int nota_repetida = 0;
            for (int i = 0; i < total_notas_fiscais; i++) {
                if (notas_fiscais[i] == nota_fiscal) {
                    nota_repetida = 1;
                    break;
                }
            }
            if (nota_repetida) {
                printf("Nota fiscal repetida\n");
                erro = 1;
            }
        }

        // Se houver algum erro, solicitar novamente os dados da venda
        if (erro) {
            printf("Informe novamente os dados da venda\n");
            continue;  // Pular para a próxima iteração e pedir novamente a venda
        }

        // Registrar a venda, já que todos os campos são válidos
        notas_fiscais[total_notas_fiscais++] = nota_fiscal;  // Armazenar a nota fiscal

        // Atualizar os totais
        total_vendas_mes += valor_venda;
        vendas_por_dia[dia]++;
        total_vendas_por_dia[dia] += valor_venda;

        vendas_por_vendedor[codigo_vendedor]++;
        total_vendedor[codigo_vendedor] += valor_venda;
        vendas_dia_vendedor[codigo_vendedor][dia] += valor_venda;  // Registra a venda por dia para o vendedor

        total_vendas++;
    }

    // Calcular comissão para cada vendedor
    for (int i = 1; i <= num_vendedores; i++) {
        if (total_vendedor[i] <= 2000) {
            comissao_vendedor[i] = total_vendedor[i] * 0.05;
        } else if (total_vendedor[i] < 5000) {
            comissao_vendedor[i] = total_vendedor[i] * 0.07;
        } else {
            comissao_vendedor[i] = total_vendedor[i] * 0.10;
        }
        total_comissao_mes += comissao_vendedor[i];
    }

    // Exibir resumo por vendedor
    printf("\nRESUMO DE VENDAS POR VENDEDOR\n");
    for (int i = 1; i <= num_vendedores; i++) {
        if (vendas_por_vendedor[i] > 0) {
            printf("Vendedor %d\n", i);
            for (int j = 1; j <= MAX_DIAS; j++) {
                if (vendas_dia_vendedor[i][j] > 0) {
                    printf ("\n");
                    printf("dia %d: %.2f reais\n", j, vendas_dia_vendedor[i][j]);
                }
            }

            // Cálculo correto do valor médio vendido por dia: total de vendas dividido pelo número de dias no mês
            int dias_no_mes = 31;  // Considerando meses de 31 dias inicialmente
            if (mes == 2) dias_no_mes = 28;  // Fevereiro
            if (mes == 4 || mes == 6 || mes == 9 || mes == 11) dias_no_mes = 30;  // Meses com 30 dias

            // Valor médio vendido por dia é o total vendido dividido pelo número de dias no mês
            printf("\n");
            printf("valor medio vendido por dia: %.2f reais\n", total_vendedor[i] / dias_no_mes);
            printf("\n");

            // Exibir a porcentagem da comissão
            if (total_vendedor[i] <= 2000) {
                printf("valor da comissao (5%%): %.2f reais\n\n", comissao_vendedor[i]);
            } else if (total_vendedor[i] < 5000) {
                printf("valor da comissao (7%%): %.2f reais\n\n", comissao_vendedor[i]);
            } else {
                printf("valor da comissao (10%%): %.2f reais\n\n", comissao_vendedor[i]);
            }
        }
    }

    // Exibir resumo por dia
    printf("\nRESUMO DE VENDAS POR DIA\n");
    for (int i = 1; i <= MAX_DIAS; i++) {
        if (vendas_por_dia[i] > 0) {
            printf("Dia %d: %d venda(s) com valor total de %.2f reais\n", i, vendas_por_dia[i], total_vendas_por_dia[i]);
        }
    }

    // Exibir resumo do mês
    printf("\nRESUMO DE VENDAS NO MES\n");
    printf("quantidade de vendas: %d\n", total_vendas);
    printf("valor total vendido: %.2f reais\n", total_vendas_mes);
    printf("valor total de comissoes pagas: %.2f reais\n", total_comissao_mes);

    return 0;
}
